<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DrawHelloKitty</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: linear-gradient(135deg, #ffccff, #ff99cc);
      text-align: center;
      padding: 2rem;
      color: #d63384;
      min-height: 100vh;
      overflow-x: hidden;
    }

    h1 {
      font-size: 3rem;
      color: #ff3399;
      text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
      margin-bottom: 1.5rem;
    }

    .tab-container {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .tab {
      padding: 0.75rem 1.5rem;
      background: #ff99cc;
      border-radius: 10px 10px 0 0;
      cursor: pointer;
      font-size: 1.25rem;
      transition: all 0.3s;
    }

    .tab:hover {
      background: #ff66b2;
      transform: translateY(-2px);
    }

    .tab.active {
      background: #ff66b2;
      color: white;
    }

    .content-area {
      display: none;
    }

    .content-area.active {
      display: block;
    }

    .toolbox {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(255, 230, 240, 0.95);
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(255, 138, 198, 0.5);
    }

    .section {
      padding: 1.5rem;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
    }

    .section h3 {
      color: #ff3399;
      font-size: 1.5rem;
      margin-bottom: 0.75rem;
    }

    button, select, input[type="text"], input[type="color"], input[type="range"] {
      font-family: inherit;
      background: #ff99cc;
      border: none;
      padding: 0.75rem 1rem;
      margin: 0.25rem;
      border-radius: 8px;
      box-shadow: 2px 2px 4px rgba(255, 92, 170, 0.5);
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.2s;
      width: 100%;
      max-width: 200px;
      text-align: center;
    }

    button:hover, select:hover, input:hover {
      background: #ff66b2;
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }

    #canvas {
      border: 4px dotted #fff;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      cursor: crosshair;
      max-width: 100%;
      touch-action: none;
    }

    .game-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .game-window {
      background: #ffe6f0;
      padding: 2rem;
      border-radius: 20px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 0 20px rgba(255, 140, 180, 0.8);
      position: relative;
    }

    .game-canvas {
      background: white;
      border: 3px dashed #ff99cc;
      border-radius: 10px;
      margin: 1rem auto;
      display: block;
      max-width: 100%;
    }

    .close-game {
      background: #ff5caa;
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 10px;
      margin-top: 1rem;
    }

    .sticker-palette {
      display: none;
      position: absolute;
      background: #ffe6f0;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 10;
    }

    .sticker {
      font-size: 2rem;
      cursor: pointer;
      margin: 0.5rem;
      display: inline-block;
      transition: transform 0.2s;
    }

    .sticker:hover {
      transform: scale(1.2);
    }

    .prompt-container {
      font-size: 1.25rem;
      color: #ff3399;
      margin: 1rem 0;
    }

    .undo-redo {
      display: flex;
      justify-content: center;
      gap: 1rem;
      width: 100%;
    }

    .reward-animation {
      font-size: 3rem;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation: bounce 0.5s 3;
    }

    @keyframes bounce {
      0%, 100% { transform: translate(-50%, -50%); }
      50% { transform: translate(-50%, -70%); }
    }

    @media (max-width: 768px) {
      h1 { font-size: 2rem; }
      .tab { font-size: 1rem; padding: 0.5rem 1rem; }
      .toolbox { grid-template-columns: 1fr; gap: 1rem; padding: 1rem; }
      button, select, input { font-size: 0.9rem; padding: 0.5rem; }
      #canvas, .game-canvas { width: 100%; height: auto; }
      .game-window { width: 95%; padding: 1rem; }
      .section { padding: 1rem; }
    }
  </style>
</head>
<body>
  <h1>DrawHelloKitty üéÄ‚úèÔ∏è</h1>

  <div class="tab-container">
    <div class="tab active" onclick="switchTab('drawing')" aria-label="Drawing Tab">Drawing</div>
    <div class="tab" onclick="switchTab('games')" aria-label="Games Tab">Games</div>
    <div class="tab" onclick="switchTab('learn')" aria-label="Learn to Draw Tab">Learn to Draw</div>
  </div>

  <div id="drawing-tab" class="content-area active">
    <div class="prompt-container" id="drawingPrompt">Click "New Prompt" for a fun drawing idea!</div>
    <div class="toolbox">
      <div class="section">
        <h3>Brush Tools</h3>
        <select id="brushType" aria-label="Brush Type Selector">
          <option value="crayon">Crayon</option>
          <option value="marker">Marker</option>
        </select>
        <h3>Color</h3>
        <input type="color" id="colorPicker" value="#ff1493" aria-label="Color Picker"/>
        <h3>Size: <span id="sizeValue">5</span></h3>
        <input type="range" id="sizeSlider" min="1" max="20" value="5" aria-label="Brush Size Slider"/>
      </div>
      <div class="section">
        <h3>Shapes</h3>
        <button onclick="drawShape('circle')" aria-label="Draw Circle">‚≠ï Circle</button>
        <button onclick="drawShape('square')" aria-label="Draw Square">‚¨õ Square</button>
        <button onclick="drawShape('triangle')" aria-label="Draw Triangle">üî∫ Triangle</button>
      </div>
      <div class="section">
        <h3>Stickers & Text</h3>
        <button onclick="showStickers()" aria-label="Show Stickers">üéÄ Stickers</button>
        <button onclick="stampEmoji('üò∫')" aria-label="Kitty Sticker">üò∫ Kitty</button>
        <h3>Your Name</h3>
        <input type="text" id="nameInput" placeholder="Enter your name" aria-label="Name Input"/>
        <button onclick="addName()" aria-label="Add Name">Add Name</button>
      </div>
      <div class="section">
        <h3>Canvas Tools</h3>
        <button onclick="toggleEraser()" aria-label="Toggle Eraser">üßΩ Eraser</button>
        <button onclick="clearCanvas()" aria-label="Clear Canvas">üóëÔ∏è Clear</button>
        <div class="undo-redo">
          <button onclick="undo()" aria-label="Undo">‚Ü©Ô∏è Undo</button>
          <button onclick="redo()" aria-label="Redo">‚Ü™Ô∏è Redo</button>
        </div>
      </div>
      <div class="section">
        <h3>Save & Share</h3>
        <button onclick="saveImage('png')" aria-label="Save PNG">üíæ Save PNG</button>
        <button onclick="saveImage('pdf')" aria-label="Save PDF">üìÑ Save PDF</button>
        <h3>Background</h3>
        <select onchange="changeTheme(this.value)" aria-label="Background Theme Selector">
          <option value="white">White</option>
          <option value="pink">Pink</option>
          <option value="sky">Sky Blue</option>
        </select>
      </div>
      <div class="section">
        <h3>Fun Activities</h3>
        <button onclick="generateDrawingPrompt()" aria-label="New Drawing Prompt">‚ú® New Prompt</button>
        <button onclick="startColoringBook()" aria-label="Coloring Book">üñçÔ∏è Coloring Book</button>
        <button onclick="startConnectDots()" aria-label="Connect Dots">üî¢ Connect Dots</button>
      </div>
    </div>
    <canvas id="canvas" width="700" height="500" aria-label="Drawing Canvas"></canvas>
  </div>

  <div id="games-tab" class="content-area">
    <div class="section" style="max-width: 600px; margin: 0 auto;">
      <h2>üéÆ Fun Games üéÆ</h2>
      <button onclick="startScienceQuiz()" aria-label="Science Quiz">üî¨ Science Quiz</button>
      <button onclick="startScienceExperiment()" aria-label="Science Experiment">üß™ Science Experiment</button>
      <button onclick="startClockTimeGame()" aria-label="Clock Time Game">‚è∞ Clock Time</button>
      <button onclick="startShopkeeperMoneyGame()" aria-label="Shopkeeper Money Game">üí∏ Shopkeeper</button>
    </div>
  </div>

  <div id="learn-tab" class="content-area">
    <div class="section" style="max-width: 600px; margin: 0 auto;">
      <h2>‚úèÔ∏è Learn to Draw ‚úèÔ∏è</h2>
      <div id="tutorial-steps">
        <h3>Let's draw a cute cat!</h3>
        <ol style="text-align: left; font-size: 1.1rem;">
          <li>Draw a circle for the head</li>
          <li>Add two triangle ears</li>
          <li>Draw two dots for eyes</li>
        </ol>
        <button onclick="showStepByStep('cat')" aria-label="Cat Drawing Tutorial">Show Me How</button>
        <h3>Let's draw a flower!</h3>
        <ol style="text-align: left; font-size: 1.1rem;">
          <li>Draw a small circle</li>
          <li>Add petals around it</li>
          <li>Draw a stem</li>
        </ol>
        <button onclick="showStepByStep('flower')" aria-label="Flower Drawing Tutorial">Show Me How</button>
      </div>
    </div>
  </div>

  <div class="sticker-palette" id="stickerPalette" aria-label="Sticker Palette">
    <div class="sticker" onclick="stampEmoji('üò∫')" aria-label="Kitty Sticker">üò∫</div>
    <div class="sticker" onclick="stampEmoji('üå∏')" aria-label="Flower Sticker">üå∏</div>
    <div class="sticker" onclick="stampEmoji('üéÄ')" aria-label="Bow Sticker">üéÄ</div>
  </div>

  <div class="game-container" id="gameContainer" aria-label="Game Container">
    <div class="game-window">
      <h2 id="gameTitle">Game</h2>
      <canvas class="game-canvas" id="gameCanvas" width="400" height="400" aria-label="Game Canvas"></canvas>
      <div id="gameInstructions" style="margin: 1rem 0; font-size: 1.1rem;"></div>
      <div id="gameScore" style="font-weight: bold; margin: 1rem 0; font-size: 1.1rem;"></div>
      <button class="close-game" onclick="closeGame()" aria-label="Close Game">Close Game</button>
    </div>
  </div>

  <footer style="margin-top: 2rem; font-size: 1.1rem; color: #aa1166;">
    Made with ‚ù§Ô∏è by Nakshu | ¬© 2025 DrawHelloKitty
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Canvas setup
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d", { alpha: true });
      const gameCanvas = document.getElementById("gameCanvas");
      const gameCtx = gameCanvas.getContext("2d", { alpha: true });

      // Drawing state
      let drawing = false;
      let brushColor = "#ff1493";
      let brushSize = 5;
      let isEraser = false;
      let currentBrush = "crayon";
      let drawingHistory = [];
      let historyIndex = -1;
      let connectDotsMode = false;
      let dotPoints = [];
      let coloringBookMode = false;
      let coloringBookImage = null;
      let lastPoint = null;
      let canvasBackground = "white";
      let currentGame = null;
      let gameScore = 0;
      let currentQuestion = 0;
      let questions = [];
      let experimentChemicals = [];
      let targetTime = { hour: 0, minute: 0 };
      let clockHands = { hour: 0, minute: 0 };
      let shopItem = { name: "", price: 0 };
      let moneyOptions = [];

      // Initialize
      const colorPicker = document.getElementById("colorPicker");
      const sizeSlider = document.getElementById("sizeSlider");
      const sizeValue = document.getElementById("sizeValue");
      const brushType = document.getElementById("brushType");

      colorPicker.value = brushColor;
      sizeSlider.oninput = function(e) {
        brushSize = e.target.value;
        sizeValue.textContent = brushSize;
      };

      brushType.onchange = function(e) {
        currentBrush = e.target.value;
        isEraser = false;
      };

      colorPicker.oninput = function(e) {
        brushColor = e.target.value;
        isEraser = false;
      };

      // Event listeners
      canvas.addEventListener("mousedown", startDrawing);
      canvas.addEventListener("mouseup", stopDrawing);
      canvas.addEventListener("mouseleave", stopDrawing);
      canvas.addEventListener("mousemove", draw);
      canvas.addEventListener("touchstart", handleTouchStart, { passive: false });
      canvas.addEventListener("touchmove", handleTouchMove, { passive: false });
      canvas.addEventListener("touchend", stopDrawing, { passive: false });

      // Utility functions
      function getCanvasCoords(e, canvasElement) {
        const rect = canvasElement.getBoundingClientRect();
        const clientX = e.clientX || (e.touches && e.touches[0].clientX);
        const clientY = e.clientY || (e.touches && e.touches[0].clientY);
        return {
          x: (clientX - rect.left) * (canvasElement.width / rect.width),
          y: (clientY - rect.top) * (canvasElement.height / rect.height)
        };
      }

      // Tab switching
      window.switchTab = function(tab) {
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        document.querySelectorAll(".content-area").forEach(c => c.classList.remove("active"));
        document.querySelector(`.tab[onclick="switchTab('${tab}')"]`).classList.add("active");
        document.getElementById(`${tab}-tab`).classList.add("active");
        if (tab !== "drawing") {
          coloringBookMode = false;
          connectDotsMode = false;
        }
      };

      // Drawing functions
      function startDrawing(e) {
        e.preventDefault();
        if (coloringBookMode || connectDotsMode) {
          handleSpecialMode(e);
          return;
        }
        drawing = true;
        saveDrawingState();
        draw(e);
      }

      function stopDrawing() {
        drawing = false;
        ctx.beginPath();
        lastPoint = null;
      }

      function draw(e) {
        if (!drawing) return;
        const { x, y } = getCanvasCoords(e, canvas);
        ctx.lineJoin = "round";
        ctx.lineCap = "round";
        if (isEraser) {
          ctx.globalCompositeOperation = "destination-out";
          ctx.strokeStyle = "rgba(0,0,0,1)";
        } else {
          ctx.globalCompositeOperation = "source-over";
          ctx.strokeStyle = brushColor;
          ctx.fillStyle = brushColor;
        }
        ctx.lineWidth = brushSize;
        if (currentBrush === "crayon") {
          drawCrayon(x, y);
        } else {
          drawMarker(x, y);
        }
      }

      function drawCrayon(x, y) {
        if (lastPoint) {
          ctx.beginPath();
          ctx.moveTo(lastPoint.x, lastPoint.y);
          ctx.lineTo(x, y);
          ctx.stroke();
        }
        ctx.beginPath();
        ctx.arc(x, y, brushSize / 2, 0, Math.PI * 2);
        ctx.fill();
        lastPoint = { x, y };
      }

      function drawMarker(x, y) {
        if (lastPoint) {
          ctx.beginPath();
          ctx.moveTo(lastPoint.x, lastPoint.y);
          ctx.lineTo(x, y);
          ctx.stroke();
        }
        lastPoint = { x, y };
      }

      function handleTouchStart(e) {
        e.preventDefault();
        const touch = e.touches[0];
        const mouseEvent = new MouseEvent("mousedown", {
          clientX: touch.clientX,
          clientY: touch.clientY
        });
        canvas.dispatchEvent(mouseEvent);
      }

      function handleTouchMove(e) {
        e.preventDefault();
        const touch = e.touches[0];
        const mouseEvent = new MouseEvent("mousemove", {
          clientX: touch.clientX,
          clientY: touch.clientY
        });
        canvas.dispatchEvent(mouseEvent);
      }

      // Shape drawing
      window.drawShape = function(shape) {
        saveDrawingState();
        ctx.fillStyle = brushColor;
        ctx.strokeStyle = brushColor;
        ctx.lineWidth = brushSize;
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const size = Math.min(canvas.width, canvas.height) * 0.3;
        ctx.beginPath();
        switch (shape) {
          case "circle":
            ctx.arc(centerX, centerY, size / 2, 0, Math.PI * 2);
            ctx.fill();
            break;
          case "square":
            ctx.rect(centerX - size / 2, centerY - size / 2, size, size);
            ctx.fill();
            break;
          case "triangle":
            ctx.moveTo(centerX, centerY - size / 2);
            ctx.lineTo(centerX + size / 2, centerY + size / 2);
            ctx.lineTo(centerX - size / 2, centerY + size / 2);
            ctx.closePath();
            ctx.fill();
            break;
        }
      };

      // Tool functions
      window.toggleEraser = function() {
        isEraser = !isEraser;
        brushType.value = isEraser ? "crayon" : currentBrush;
      };

      window.clearCanvas = function() {
        saveDrawingState();
        ctx.fillStyle = canvasBackground;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        if (coloringBookMode && coloringBookImage) {
          ctx.drawImage(coloringBookImage, 0, 0, canvas.width, canvas.height);
        }
        if (connectDotsMode) {
          renderDots();
        }
      };

      window.changeTheme = function(theme) {
        canvasBackground = theme === "pink" ? "#ffe6f0" : theme === "sky" ? "#e0f7fa" : "white";
        clearCanvas();
      };

      window.addName = function() {
        const name = document.getElementById("nameInput").value.trim();
        if (!name) return;
        saveDrawingState();
        ctx.fillStyle = brushColor;
        ctx.font = "24px Comic Sans MS";
        ctx.fillText(name, 20, 40);
      };

      window.stampEmoji = function(emoji) {
        saveDrawingState();
        ctx.font = "40px serif";
        ctx.fillStyle = brushColor;
        const x = Math.random() * (canvas.width - 50) + 25;
        const y = Math.random() * (canvas.height - 50) + 25;
        ctx.fillText(emoji, x, y);
      };

      window.showStickers = function() {
        const palette = document.getElementById("stickerPalette");
        palette.style.display = "block";
        palette.style.left = "50px";
        palette.style.top = "50px";
        document.addEventListener("click", closeStickers, { once: true });
      };

      function closeStickers(e) {
        const palette = document.getElementById("stickerPalette");
        if (!palette.contains(e.target)) {
          palette.style.display = "none";
        } else {
          document.addEventListener("click", closeStickers, { once: true });
        }
      }

      // History functions
      function saveDrawingState() {
        if (historyIndex < drawingHistory.length - 1) {
          drawingHistory = drawingHistory.slice(0, historyIndex + 1);
        }
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        drawingHistory.push(imageData);
        historyIndex++;
        if (drawingHistory.length > 20) {
          drawingHistory.shift();
          historyIndex--;
        }
      }

      window.undo = function() {
        if (historyIndex <= 0) return;
        historyIndex--;
        ctx.putImageData(drawingHistory[historyIndex], 0, 0);
        if (coloringBookMode && coloringBookImage) {
          ctx.drawImage(coloringBookImage, 0, 0, canvas.width, canvas.height);
        }
        if (connectDotsMode) {
          renderDots();
        }
      };

      window.redo = function() {
        if (historyIndex >= drawingHistory.length - 1) return;
        historyIndex++;
        ctx.putImageData(drawingHistory[historyIndex], 0, 0);
        if (coloringBookMode && coloringBookImage) {
          ctx.drawImage(coloringBookImage, 0, 0, canvas.width, canvas.height);
        }
        if (connectDotsMode) {
          renderDots();
        }
      };

      // Drawing Prompt
      window.generateDrawingPrompt = function() {
        const prompts = [
          "Draw a rocket in space üöÄ",
          "Draw a clock showing 6:00 ‚è∞",
          "Draw a shop with toys üè¨",
          "Draw a scientist in a lab üß™",
          "Draw the solar system ‚òÄÔ∏è"
        ];
        document.getElementById("drawingPrompt").textContent = prompts[Math.floor(Math.random() * prompts.length)];
      };

      // Coloring Book
      window.startColoringBook = function() {
        saveDrawingState();
        coloringBookMode = true;
        connectDotsMode = false;
        clearCanvas();
        coloringBookImage = new Image();
        coloringBookImage.src = createColoringBookImage();
        coloringBookImage.onload = () => {
          ctx.drawImage(coloringBookImage, 0, 0, canvas.width, canvas.height);
        };
      };

      function createColoringBookImage() {
        const tempCanvas = document.createElement("canvas");
        tempCanvas.width = canvas.width;
        tempCanvas.height = canvas.height;
        const tempCtx = tempCanvas.getContext("2d");
        tempCtx.strokeStyle = "black";
        tempCtx.lineWidth = 2;
        tempCtx.beginPath();
        tempCtx.arc(canvas.width / 2, canvas.height / 2, 100, 0, Math.PI * 2);
        tempCtx.stroke();
        return tempCanvas.toDataURL();
      }

      // Connect-the-Dots
      window.startConnectDots = function() {
        saveDrawingState();
        connectDotsMode = true;
        coloringBookMode = false;
        clearCanvas();
        dotPoints = generateDots();
        renderDots();
      };

      function generateDots() {
        const points = [];
        const numDots = 5;
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = 100;
        for (let i = 0; i < numDots; i++) {
          const angle = (i / numDots) * Math.PI * 2;
          points.push({ x: centerX + Math.cos(angle) * radius, y: centerY + Math.sin(angle) * radius, number: i + 1 });
        }
        return points;
      }

      function renderDots() {
        ctx.fillStyle = "black";
        ctx.font = "20px Comic Sans MS";
        dotPoints.forEach(point => {
          ctx.beginPath();
          ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);
          ctx.fill();
          ctx.fillText(point.number, point.x + 10, point.y + 10);
        });
      }

      function handleSpecialMode(e) {
        const { x, y } = getCanvasCoords(e, canvas);
        if (connectDotsMode) {
          const clickedDot = dotPoints.find(dot => 
            Math.hypot(dot.x - x, dot.y - y) < 10
          );
          if (clickedDot && clickedDot.number === dotPoints[0].number) {
            saveDrawingState();
            ctx.beginPath();
            ctx.moveTo(clickedDot.x, clickedDot.y);
            dotPoints.push(dotPoints.shift());
            renderDots();
          } else if (clickedDot && clickedDot.number === dotPoints[0].number + 1) {
            saveDrawingState();
            ctx.strokeStyle = brushColor;
            ctx.lineWidth = brushSize;
            ctx.lineTo(clickedDot.x, clickedDot.y);
            ctx.stroke();
            dotPoints.push(dotPoints.shift());
            renderDots();
          }
        }
      }

      // Save/export
      window.saveImage = function(type) {
        const link = document.createElement("a");
        const fileName = `DrawHelloKitty_${new Date().toISOString().slice(0,10)}.${type}`;
        link.download = fileName;
        if (type === "pdf") {
          try {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            const imgData = canvas.toDataURL("image/png");
            pdf.addImage(imgData, "PNG", 10, 10, canvas.width / 4, canvas.height / 4);
            pdf.save(fileName);
          } catch (e) {
            alert("PDF export failed. Try PNG.");
          }
          return;
        }
        link.href = canvas.toDataURL(`image/${type}`);
        link.click();
      };

      // Game functions
      window.closeGame = function() {
        document.getElementById("gameContainer").style.display = "none";
        gameCanvas.onclick = null;
        document.querySelectorAll(".reward-animation").forEach(el => el.remove());
        currentGame = null;
        gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
      };

      function showRewardAnimation(emoji = "üò∫") {
        const reward = document.createElement("div");
        reward.className = "reward-animation";
        reward.textContent = emoji;
        document.getElementById("gameContainer").appendChild(reward);
        setTimeout(() => reward.remove(), 1500);
      }

      // Science Quiz Game
      window.startScienceQuiz = function() {
        currentGame = "scienceQuiz";
        document.getElementById("gameContainer").style.display = "flex";
        document.getElementById("gameTitle").textContent = "Science Quiz Game";
        document.getElementById("gameInstructions").textContent = "Click the correct answer to earn points! üåü";
        gameScore = 0;
        currentQuestion = 0;
        document.getElementById("gameScore").textContent = `Score: ${gameScore}`;
        questions = [
          { question: "What planet is known as the Red Planet?", answers: ["Mars", "Venus", "Jupiter"], correct: 0 },
          { question: "What is the largest organ in the human body?", answers: ["Heart", "Skin", "Lung"], correct: 1 },
          { question: "What force pulls objects to the ground?", answers: ["Magnetism", "Gravity", "Electricity"], correct: 1 }
        ];
        renderScienceQuiz();
        gameCanvas.onclick = handleQuizAnswer;
      };

      function renderScienceQuiz() {
        gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
        if (currentQuestion >= questions.length) {
          gameCtx.font = "30px Comic Sans MS";
          gameCtx.fillStyle = "black";
          gameCtx.fillText(`Game Over! Score: ${gameScore}`, 50, 200);
          gameCanvas.onclick = null;
          return;
        }
        const q = questions[currentQuestion];
        gameCtx.font = "20px Comic Sans MS";
        gameCtx.fillStyle = "black";
        gameCtx.fillText(q.question, 50, 100);
        for (let i = 0; i < q.answers.length; i++) {
          gameCtx.fillStyle = "#ff66b2";
          gameCtx.fillRect(50, 150 + i * 60, 300, 50);
          gameCtx.fillStyle = "white";
          gameCtx.fillText(q.answers[i], 60, 180 + i * 60);
        }
      }

      function handleQuizAnswer(e) {
        const { x, y } = getCanvasCoords(e, gameCanvas);
        const q = questions[currentQuestion];
        for (let i = 0; i < q.answers.length; i++) {
          if (x >= 50 && x <= 350 && y >= 150 + i * 60 && y <= 200 + i * 60) {
            if (i === q.correct) {
              gameScore += 10;
              showRewardAnimation();
            } else {
              gameScore = Math.max(0, gameScore - 2);
            }
            document.getElementById("gameScore").textContent = `Score: ${gameScore}`;
            currentQuestion++;
            renderScienceQuiz();
            break;
          }
        }
      }

      // Science Experiment Game
      window.startScienceExperiment = function() {
        currentGame = "scienceExperiment";
        document.getElementById("gameContainer").style.display = "flex";
        document.getElementById("gameTitle").textContent = "Science Experiment Game";
        document.getElementById("gameInstructions").textContent = "Click chemicals to mix them and see what happens! üß™";
        gameScore = 0;
        document.getElementById("gameScore").textContent = `Reactions: ${gameScore}`;
        experimentChemicals = [];
        renderScienceExperiment();
        gameCanvas.onclick = handleExperimentMix;
      };

      function renderScienceExperiment() {
        gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
        gameCtx.strokeStyle = "black";
        gameCtx.lineWidth = 2;
        gameCtx.beginPath();
        gameCtx.moveTo(150, 100);
        gameCtx.lineTo(150, 300);
        gameCtx.lineTo(250, 300);
        gameCtx.lineTo(250, 100);
        gameCtx.stroke();
        if (experimentChemicals.length > 0) {
          const mixedColor = experimentChemicals.length === 2 ? mixColors(experimentChemicals[0], experimentChemicals[1]) : experimentChemicals[0];
          gameCtx.fillStyle = mixedColor;
          gameCtx.fillRect(150, 200, 100, 100);
        }
        const chemicals = ["#ff0000", "#00ff00", "#0000ff"];
        for (let i = 0; i < chemicals.length; i++) {
          gameCtx.fillStyle = chemicals[i];
          gameCtx.fillRect(50 + i * 100, 320, 80, 40);
        }
      }

      function mixColors(c1, c2) {
        if ((c1 === "#ff0000" && c2 === "#00ff00") || (c1 === "#00ff00" && c2 === "#ff0000")) return "#ffff00";
        if ((c1 === "#ff0000" && c2 === "#0000ff") || (c1 === "#0000ff" && c2 === "#ff0000")) return "#ff00ff";
        if ((c1 === "#00ff00" && c2 === "#0000ff") || (c1 === "#0000ff" && c2 === "#00ff00")) return "#00ffff";
        return c1;
      }

      function handleExperimentMix(e) {
        const { x, y } = getCanvasCoords(e, gameCanvas);
        if (y >= 320 && y <= 360) {
          const index = Math.floor((x - 50) / 100);
          if (index >= 0 && index < 3) {
            experimentChemicals.push(["#ff0000", "#00ff00", "#0000ff"][index]);
            if (experimentChemicals.length > 2) experimentChemicals.shift();
            gameScore++;
            showRewardAnimation("üß™");
            document.getElementById("gameScore").textContent = `Reactions: ${gameScore}`;
            renderScienceExperiment();
          }
        }
      }

      // Clock Time Game
      window.startClockTimeGame = function() {
        currentGame = "clockTime";
        document.getElementById("gameContainer").style.display = "flex";
        document.getElementById("gameTitle").textContent = "Clock Time Game";
        document.getElementById("gameInstructions").textContent = "Click to set the hour and minute hands to match the time! ‚è∞";
        gameScore = 0;
        document.getElementById("gameScore").textContent = `Score: ${gameScore}`;
        generateTargetTime();
        clockHands = { hour: 0, minute: 0 };
        renderClockTimeGame();
        gameCanvas.onclick = handleClockTimeClick;
      };

      function generateTargetTime() {
        const hours = [1, 3, 6, 9, 12];
        const minutes = [0, 30];
        targetTime = {
          hour: hours[Math.floor(Math.random() * hours.length)],
          minute: minutes[Math.floor(Math.random() * minutes.length)]
        };
      }

      function renderClockTimeGame() {
        gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
        gameCtx.beginPath();
        gameCtx.arc(200, 200, 150, 0, Math.PI * 2);
        gameCtx.fillStyle = "#ffccff";
        gameCtx.fill();
        gameCtx.strokeStyle = "black";
        gameCtx.lineWidth = 5;
        gameCtx.stroke();
        gameCtx.font = "20px Comic Sans MS";
        gameCtx.fillStyle = "black";
        for (let i = 1; i <= 12; i++) {
          const angle = (i * 30 - 90) * Math.PI / 180;
          gameCtx.fillText(i, 200 + Math.cos(angle) * 120 - 10, 200 + Math.sin(angle) * 120 + 10);
        }
        const hourAngle = (clockHands.hour % 12 * 30 + clockHands.minute / 2 - 90) * Math.PI / 180;
        gameCtx.beginPath();
        gameCtx.moveTo(200, 200);
        gameCtx.lineTo(200 + Math.cos(hourAngle) * 80, 200 + Math.sin(hourAngle) * 80);
        gameCtx.strokeStyle = "black";
        gameCtx.lineWidth = 8;
        gameCtx.stroke();
        const minuteAngle = (clockHands.minute * 6 - 90) * Math.PI / 180;
        gameCtx.beginPath();
        gameCtx.moveTo(200, 200);
        gameCtx.lineTo(200 + Math.cos(minuteAngle) * 120, 200 + Math.sin(minuteAngle) * 120);
        gameCtx.strokeStyle = "black";
        gameCtx.lineWidth = 4;
        gameCtx.stroke();
        gameCtx.font = "20px Comic Sans MS";
        gameCtx.fillStyle = "black";
        const timeString = `${targetTime.hour}:${targetTime.minute === 0 ? '00' : '30'}`;
        gameCtx.fillText(`Set the clock to ${timeString}`, 50, 50);
        gameCtx.fillStyle = "#ff66b2";
        gameCtx.fillRect(50, 320, 80, 40);
        gameCtx.fillRect(150, 320, 80, 40);
        gameCtx.fillStyle = "white";
        gameCtx.fillText("Hour +1", 60, 345);
        gameCtx.fillText("Minute +30", 160, 345);
      }

      function handleClockTimeClick(e) {
        const { x, y } = getCanvasCoords(e, gameCanvas);
        if (y >= 320 && y <= 360) {
          if (x >= 50 && x <= 130) {
            clockHands.hour = (clockHands.hour + 1) % 12;
          } else if (x >= 150 && x <= 230) {
            clockHands.minute = (clockHands.minute + 30) % 60;
          }
          renderClockTimeGame();
          if (clockHands.hour === targetTime.hour && clockHands.minute === targetTime.minute) {
            gameScore += 10;
            showRewardAnimation("‚è∞");
            document.getElementById("gameScore").textContent = `Score: ${gameScore}`;
            generateTargetTime();
            clockHands = { hour: 0, minute: 0 };
            renderClockTimeGame();
          }
        }
      }

      // Shopkeeper Money Game
      window.startShopkeeperMoneyGame = function() {
        currentGame = "shopkeeperMoney";
        document.getElementById("gameContainer").style.display = "flex";
        document.getElementById("gameTitle").textContent = "Shopkeeper Money Game";
        document.getElementById("gameInstructions").textContent = "Click the money to pay the shopkeeper! üí∏";
        gameScore = 0;
        document.getElementById("gameScore").textContent = `Score: ${gameScore}`;
        generateShopItem();
        renderShopkeeperMoneyGame();
        gameCanvas.onclick = handleShopkeeperMoneyClick;
      };

      function generateShopItem() {
        const items = [
          { name: "Candy üç¨", price: 2 },
          { name: "Toy üß∏", price: 3 },
          { name: "Balloon üéà", price: 1 }
        ];
        shopItem = items[Math.floor(Math.random() * items.length)];
        moneyOptions = [1, 2, 3].sort(() => Math.random() - 0.5);
      }

      function renderShopkeeperMoneyGame() {
        gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
        gameCtx.fillStyle = "#ffccff";
        gameCtx.fillRect(0, 0, 400, 400);
        gameCtx.font = "60px serif";
        gameCtx.fillStyle = "black";
        gameCtx.fillText("üò∫", 50, 100);
        gameCtx.fillStyle = "white";
        gameCtx.fillRect(100, 50, 250, 80);
        gameCtx.strokeStyle = "black";
        gameCtx.lineWidth = 2;
        gameCtx.strokeRect(100, 50, 250, 80);
        gameCtx.font = "20px Comic Sans MS";
        gameCtx.fillStyle = "black";
        gameCtx.fillText(`Hello! ${shopItem.name} costs $${shopItem.price}!`, 110, 90);
        for (let i = 0; i < moneyOptions.length; i++) {
          gameCtx.fillStyle = "#ff66b2";
          gameCtx.fillRect(50 + i * 100, 320, 80, 40);
          gameCtx.fillStyle = "white";
          gameCtx.fillText(`$${moneyOptions[i]}`, 70 + i * 100, 345);
        }
      }

      function handleShopkeeperMoneyClick(e) {
        const { x, y } = getCanvasCoords(e, gameCanvas);
        if (y >= 320 && y <= 360) {
          const index = Math.floor((x - 50) / 100);
          if (index >= 0 && index < 3) {
            if (moneyOptions[index] === shopItem.price) {
              gameScore += 10;
              showRewardAnimation("üí∏");
              document.getElementById("gameScore").textContent = `Score: ${gameScore}`;
              generateShopItem();
              renderShopkeeperMoneyGame();
            } else {
              gameScore = Math.max(0, gameScore - 2);
              document.getElementById("gameScore").textContent = `Score: ${gameScore}`;
            }
          }
        }
      }

      // Tutorial
      window.showStepByStep = function(type) {
        document.getElementById("gameContainer").style.display = "flex";
        document.getElementById("gameTitle").textContent = `Learn to Draw a ${type.charAt(0).toUpperCase() + type.slice(1)}`;
        document.getElementById("gameInstructions").textContent = "Click to see the next step! ‚úèÔ∏è";
        document.getElementById("gameScore").textContent = "";
        const steps = {
          cat: [
            () => {
              gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
              gameCtx.beginPath();
              gameCtx.arc(200, 200, 80, 0, Math.PI * 2);
              gameCtx.stroke();
              gameCtx.fillText("Step 1: Draw a circle", 50, 350);
            },
            () => {
              gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
              gameCtx.beginPath();
              gameCtx.arc(200, 200, 80, 0, Math.PI * 2);
              gameCtx.stroke();
              gameCtx.beginPath();
              gameCtx.moveTo(160, 120);
              gameCtx.lineTo(140, 80);
              gameCtx.lineTo(180, 100);
              gameCtx.closePath();
              gameCtx.stroke();
              gameCtx.beginPath();
              gameCtx.moveTo(240, 120);
              gameCtx.lineTo(260, 80);
              gameCtx.lineTo(220, 100);
              gameCtx.closePath();
              gameCtx.stroke();
              gameCtx.fillText("Step 2: Add ears", 50, 350);
            },
            () => {
              gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
              gameCtx.beginPath();
              gameCtx.arc(200, 200, 80, 0, Math.PI * 2);
              gameCtx.stroke();
              gameCtx.beginPath();
              gameCtx.moveTo(160, 120);
              gameCtx.lineTo(140, 80);
              gameCtx.lineTo(180, 100);
              gameCtx.closePath();
              gameCtx.stroke();
              gameCtx.beginPath();
              gameCtx.moveTo(240, 120);
              gameCtx.lineTo(260, 80);
              gameCtx.lineTo(220, 100);
              gameCtx.closePath();
              gameCtx.stroke();
              gameCtx.beginPath();
              gameCtx.arc(180, 180, 5, 0, Math.PI * 2);
              gameCtx.fill();
              gameCtx.beginPath();
              gameCtx.arc(220, 180, 5, 0, Math.PI * 2);
              gameCtx.fill();
              gameCtx.fillText("Step 3: Add eyes", 50, 350);
            }
          ],
          flower: [
            () => {
              gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
              gameCtx.beginPath();
              gameCtx.arc(200, 200, 20, 0, Math.PI * 2);
              gameCtx.stroke();
              gameCtx.fillText("Step 1: Draw a circle", 50, 350);
            },
            () => {
              gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
              gameCtx.beginPath();
              gameCtx.arc(200, 200, 20, 0, Math.PI * 2);
              gameCtx.stroke();
              for (let i = 0; i < 4; i++) {
                const angle = (i / 4) * Math.PI * 2;
                gameCtx.beginPath();
                gameCtx.ellipse(200 + Math.cos(angle) * 40, 200 + Math.sin(angle) * 40, 10, 20, angle, 0, Math.PI * 2);
                gameCtx.stroke();
              }
              gameCtx.fillText("Step 2: Add petals", 50, 350);
            },
            () => {
              gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
              gameCtx.beginPath();
              gameCtx.arc(200, 200, 20, 0, Math.PI * 2);
              gameCtx.stroke();
              for (let i = 0; i < 4; i++) {
                const angle = (i / 4) * Math.PI * 2;
                gameCtx.beginPath();
                gameCtx.ellipse(200 + Math.cos(angle) * 40, 200 + Math.sin(angle) * 40, 10, 20, angle, 0, Math.PI * 2);
                gameCtx.stroke();
              }
              gameCtx.beginPath();
              gameCtx.moveTo(200, 220);
              gameCtx.lineTo(200, 300);
              gameCtx.stroke();
              gameCtx.fillText("Step 3: Add stem", 50, 350);
            }
          ]
        };
        let currentStep = 0;
        steps[type][currentStep]();
        gameCanvas.onclick = () => {
          currentStep = (currentStep + 1) % steps[type].length;
          steps[type][currentStep]();
        };
      };
    });
  </script>
</body>
</html>
