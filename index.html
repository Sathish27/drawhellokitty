<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Draw Hello Kitty</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: linear-gradient(to right, #ffc0cb, #ffe4e1);
      font-family: 'Comic Sans MS', cursive, sans-serif;
      text-align: center;
      color: #d63384;
    }
    h1 {
      margin-top: 10px;
    }
    canvas {
      border: 5px solid #ff69b4;
      background-color: #fff0f5;
      border-radius: 10px;
      touch-action: none;
    }
    .tools {
      margin: 10px;
    }
    button, input[type="color"] {
      margin: 5px;
      padding: 10px;
      background-color: #ffb6c1;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #ff69b4;
      color: white;
    }
    .character {
      width: 100px;
      margin: 20px auto;
    }
    .presets img {
      width: 80px;
      margin: 5px;
      cursor: pointer;
      border: 2px solid transparent;
    }
    .presets img:hover {
      border-color: #ff69b4;
    }
    @media (max-width: 600px) {
      canvas {
        width: 90vw;
        height: 60vh;
      }
    }
  </style>
</head>
<body>
  <h1>🎀 Draw Hello Kitty 🎀</h1>

  <div class="tools">
    <button onclick="setTool('brush')">🖌️ Brush</button>
    <button onclick="setTool('stamp')">🌟 Emoji</button>
    <button onclick="setTool('fill')">🪣 Fill</button>
    <button onclick="setShape('circle')">⚪ Circle</button>
    <button onclick="setShape('square')">⬛ Square</button>
    <button onclick="setShape('triangle')">🔺 Triangle</button>
    <button onclick="setShape('line')">📏 Line</button>
    <input type="color" id="colorPicker">
    <button onclick="clearCanvas()">🧹 Clear</button>
    <button onclick="downloadImage()">📥 Download</button>
  </div>

  <canvas id="draw" width="600" height="400"></canvas>
  <div>
    <input type="text" id="nameTag" placeholder="Type your name">
    <button onclick="addName()">Add Name 📝</button>
  </div>

  <div class="presets">
    <h3>🖼️ Trace These!</h3>
    <img src="https://i.imgur.com/w1URYYC.png" onclick="loadPreset(this.src)">
    <img src="https://i.imgur.com/3eJpc0D.png" onclick="loadPreset(this.src)">
  </div>

  <img src="https://media.giphy.com/media/3o6Zt481isNVuQI1l6/giphy.gif" alt="Hello Kitty" class="character" id="kitty">

  <audio id="hoverSound" src="https://www.soundjay.com/human/female-hello-1.mp3" preload="auto"></audio>

  <script>
    const canvas = document.getElementById("draw");
    const ctx = canvas.getContext("2d");
    let drawing = false, tool = 'brush', shapeMode = null;
    let startX, startY;

    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('touchstart', startDraw, { passive: false });

    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('touchmove', draw, { passive: false });

    canvas.addEventListener('mouseup', stopDraw);
    canvas.addEventListener('mouseleave', stopDraw);
    canvas.addEventListener('touchend', stopDraw);

    function setTool(t) {
      tool = t;
      shapeMode = null;
    }

    function setShape(s) {
      shapeMode = s;
      tool = 'shape';
    }

    function startDraw(e) {
      e.preventDefault();
      const rect = canvas.getBoundingClientRect();
      const x = (e.clientX || e.touches[0].clientX) - rect.left;
      const y = (e.clientY || e.touches[0].clientY) - rect.top;
      drawing = true;
      startX = x; startY = y;
      if (tool === 'fill') fillColor(x, y);
      else if (tool === 'stamp') drawStamp(x, y);
    }

    function draw(e) {
      if (!drawing || tool === 'fill' || tool === 'stamp') return;
      const rect = canvas.getBoundingClientRect();
      const x = (e.clientX || e.touches[0].clientX) - rect.left;
      const y = (e.clientY || e.touches[0].clientY) - rect.top;

      if (tool === 'brush') {
        ctx.lineWidth = 4;
        ctx.lineCap = "round";
        ctx.strokeStyle = document.getElementById("colorPicker").value;
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y);
      } else if (tool === 'shape') {
        drawShape(startX, startY, x, y, shapeMode);
      }
    }

    function stopDraw() {
      drawing = false;
      ctx.beginPath();
    }

    function drawStamp(x, y) {
      ctx.font = "24px serif";
      ctx.fillText("✨", x, y);
    }

    function drawShape(x1, y1, x2, y2, type) {
      ctx.beginPath();
      ctx.strokeStyle = document.getElementById('colorPicker').value;
      switch(type) {
        case 'circle':
          let radius = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
          ctx.arc(x1, y1, radius, 0, 2 * Math.PI);
          break;
        case 'square':
          ctx.rect(x1, y1, x2 - x1, y2 - y1);
          break;
        case 'line':
          ctx.moveTo(x1, y1);
          ctx.lineTo(x2, y2);
          break;
        case 'triangle':
          ctx.moveTo(x1, y1);
          ctx.lineTo(x2, y2);
          ctx.lineTo(x1 - (x2 - x1), y2);
          ctx.closePath();
          break;
      }
      ctx.stroke();
    }

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function addName() {
      const name = document.getElementById("nameTag").value;
      ctx.font = "20px Comic Sans MS";
      ctx.fillStyle = "#ff1493";
      ctx.fillText(name, 20, canvas.height - 20);
    }

    function downloadImage() {
      const link = document.createElement('a');
      link.download = 'drawing.png';
      link.href = canvas.toDataURL();
      link.click();
    }

    function loadPreset(src) {
      const img = new Image();
      img.src = src;
      img.onload = () => {
        ctx.globalAlpha = 0.3;
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        ctx.globalAlpha = 1.0;
      }
    }

    function fillColor(x, y) {
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const targetColor = getColorAtPixel(imageData, x, y);
      const fillColor = hexToRgb(document.getElementById("colorPicker").value);
      floodFill(imageData, x, y, targetColor, fillColor);
      ctx.putImageData(imageData, 0, 0);
    }

    function getColorAtPixel(imageData, x, y) {
      const index = (y * imageData.width + x) * 4;
      return [
        imageData.data[index],
        imageData.data[index + 1],
        imageData.data[index + 2],
        imageData.data[index + 3]
      ];
    }

    function hexToRgb(hex) {
      const bigint = parseInt(hex.slice(1), 16);
      return [(bigint >> 16) & 255, (bigint >> 8) & 255, bigint & 255, 255];
    }

    function floodFill(imageData, x, y, targetColor, fillColor) {
      const stack = [[x, y]];
      const w = imageData.width;
      const h = imageData.height;

      while (stack.length) {
        const [cx, cy] = stack.pop();
        const index = (cy * w + cx) * 4;
        if (colorsMatch(index, imageData.data, targetColor)) {
          for (let i = 0; i < 4; i++) {
            imageData.data[index + i] = fillColor[i];
          }
          if (cx > 0) stack.push([cx - 1, cy]);
          if (cx < w - 1) stack.push([cx + 1, cy]);
          if (cy > 0) stack.push([cx, cy - 1]);
          if (cy < h - 1) stack.push([cx, cy + 1]);
        }
      }
    }

    function colorsMatch(i, data, color) {
      return data[i] === color[0] &&
             data[i + 1] === color[1] &&
             data[i + 2] === color[2] &&
             data[i + 3] === color[3];
    }

    // Hover Voice
    const kitty = document.getElementById('kitty');
    const hoverSound = document.getElementById('hoverSound');
    kitty.addEventListener('mouseenter', () => {
      hoverSound.currentTime = 0;
      hoverSound.play();
    });
  </script>
</body>
</html>
